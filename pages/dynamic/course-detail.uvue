<template>
	<scroll-view class="root">
		<view class="container">

			<!-- è¯¾ç¨‹å°é¢ & æ¦‚è¦ -->
			<view class="course-header">
				<view class="course-cover">
					<view class="mask" />
					<text class="course-cover-text">ğŸ“Š è¡Œæµ‹æŠ€å·§ç²¾è®²</text>
				</view>

				<text class="course-title">è¡Œæµ‹æŠ€å·§ç²¾è®²</text>
				<text class="course-instructor">ç”± ç‹æ•™æˆ è®²æˆ</text>
				<text class="course-description">
					ç³»ç»ŸæŒæ¡è¡Œæµ‹è€ƒè¯•æ ¸å¿ƒæŠ€å·§ï¼Œæé«˜è§£é¢˜é€Ÿåº¦ä¸æ­£ç¡®ç‡ï¼ŒåŠ©åŠ›çœè€ƒé«˜åˆ†é€šè¿‡ã€‚
				</text>

				<view class="course-stats">
					<text class="stat-tag">å…± 20 èŠ‚</text>
					<text class="stat-tag">åŒ…å« 120 é“é¢˜</text>
					<text class="stat-tag">3560 äººå­¦è¿‡</text>
				</view>

				<view class="progress-container">
					<view class="progress-fill" :style="{ width: progress + '%' }" />
				</view>
				<text class="progress-text">è¯¾ç¨‹å®Œæˆåº¦ï¼š{{ progress }}%</text>
			</view>

			<!-- æ“ä½œæ  -->
			<view class="action-bar">
				<button class="continue-button" @tap="goStudy">
					<text>â–¶ ç»§ç»­å­¦ä¹ </text>
				</button>
				<view class="action-buttons">
					<view class="action-button" @tap="toggleBookmark">
						<text :class="bookmarked ? 'fas' : 'far'">ğŸ”–</text>
					</view>
					<view class="action-button" @tap="share">
						<text>ğŸ“¤</text>
					</view>
				</view>
			</view>

			<!-- è¯¾ç¨‹ç›®å½• -->
			<view class="curriculum-section">
				<text class="section-title">è¯¾ç¨‹ç›®å½•</text>

				<view v-for="(ch, idx) in chapters" :key="idx" class="chapter-item">
					<view class="chapter-header" @tap="toggleChapter(idx)">
						<text class="chapter-title">{{ ch.title }}</text>
						<text class="chapter-progress">{{ ch.done }}/{{ ch.lessons.length }} å·²å®Œæˆ</text>
					</view>

					<view class="lesson-list" :class="{ expanded: ch.expanded }">
						<view v-for="(l, i) in ch.lessons" :key="i" class="lesson-item" @tap="openLesson(l)">
							<view class="lesson-icon" :class="statusClass(l.status)">
								<text>{{ iconMap[l.status] }}</text>
							</view>
							<view class="lesson-details">
								<text class="lesson-title">{{ l.title }}</text>
								<text class="lesson-meta">{{ l.meta }}</text>
							</view>
							<button v-if="l.status !== 'locked'" class="lesson-action"
								:class="{ locked: l.status === 'locked' }" @tap.stop="openLesson(l)">
								{{ btnText[l.status] }}
							</button>
						</view>
					</view>
				</view>
			</view>

			<!-- é…å¥—èµ„æ–™ -->
			<view class="materials-section">
				<text class="section-title">é…å¥—èµ„æ–™</text>
				<view v-for="(m, idx) in materials" :key="idx" class="material-item">
					<view class="material-icon">ğŸ“„</view>
					<view class="material-details">
						<text class="material-title">{{ m.name }}</text>
						<text class="material-meta">{{ m.type }} Â· {{ m.size }}</text>
					</view>
					<button class="download-button" @tap="download(m.name)">ä¸‹è½½</button>
				</view>
			</view>

			<!-- è®²å¸ˆä»‹ç» -->
			<view class="instructor-section">
				<text class="section-title">è®²å¸ˆä»‹ç»</text>
				<view class="instructor-header">
					<view class="instructor-avatar">
						<text>ğŸ‘¨â€ğŸ«</text>
					</view>
					<view class="instructor-info">
						<text class="instructor-name">ç‹æ•™æˆ</text>
						<text class="instructor-title">è¡Œæµ‹æ•™å­¦ä¸“å®¶ Â· 10å¹´æ•™å­¦ç»éªŒ</text>
					</view>
				</view>
				<text class="instructor-description">
					ç‹æ•™æˆå…·æœ‰ä¸°å¯Œçš„è¡Œæµ‹æ•™å­¦ç»éªŒï¼Œæ›¾å¸®åŠ©æ•°åƒåå­¦ç”ŸæˆåŠŸé€šè¿‡å…¬åŠ¡å‘˜è€ƒè¯•ã€‚æ•™å­¦æ–¹æ³•æ·±å…¥æµ…å‡ºï¼Œå–„äºå°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼Œæ³¨é‡å®æˆ˜æŠ€å·§è®­ç»ƒï¼Œæ·±å—å­¦ç”Ÿå–œçˆ±ã€‚
				</text>
			</view>

		</view>
	</scroll-view>
</template>

<script setup lang="uts">
	import { ref } from 'vue'

	/* è¯¾ç¨‹è¿›åº¦ */
	const progress = ref(15)
	const bookmarked = ref(false)

	/* ç« èŠ‚æ•°æ® */
	const chapters = ref([
		{
			title: 'ç¬¬ä¸€ç«  åŸºç¡€çŸ¥è¯†',
			done: 3,
			expanded: true,
			lessons: [
				{ title: '1.1 è¡Œæµ‹è€ƒè¯•æ¦‚è¿°', meta: '12åˆ†é’Ÿ Â· è§†é¢‘', status: 'completed' },
				{ title: '1.2 è¨€è¯­ç†è§£åŸºç¡€', meta: '18åˆ†é’Ÿ Â· è§†é¢‘+ç»ƒä¹ ', status: 'completed' },
				{ title: '1.3 æ•°é‡å…³ç³»å…¥é—¨', meta: '22åˆ†é’Ÿ Â· è§†é¢‘+ç»ƒä¹ ', status: 'in-progress' },
				{ title: '1.4 åˆ¤æ–­æ¨ç†åŸºç¡€', meta: '15åˆ†é’Ÿ Â· è§†é¢‘', status: 'not-started' },
				{ title: 'ç¬¬ä¸€ç« æµ‹è¯•', meta: '30åˆ†é’Ÿ Â· æµ‹éªŒ', status: 'locked' }
			]
		},
		{
			title: 'ç¬¬äºŒç«  æ ¸å¿ƒåº”ç”¨',
			done: 0,
			expanded: false,
			lessons: [
				{ title: '2.1 è¨€è¯­ç†è§£è¿›é˜¶', meta: '20åˆ†é’Ÿ Â· è§†é¢‘+ç»ƒä¹ ', status: 'locked' }
			]
		}
	])

	/* èµ„æ–™ */
	const materials = ref([
		{ name: 'ç¬¬ä¸€ç« æ ¸å¿ƒå…¬å¼å¤§å…¨.pdf', type: 'PDF', size: '2.4MB' },
		{ name: 'ç¬¬äºŒç« ä¹ é¢˜é›†.pdf', type: 'PDF', size: '3.1MB' }
	])

	/* çŠ¶æ€æ˜ å°„ */
	const iconMap = {
		completed: 'âœ“',
		'in-progress': 'â–¶',
		'not-started': 'â—‹',
		locked: 'ğŸ”’'
	}
	const btnText = {
		completed: 'å¤ä¹ ',
		'in-progress': 'ç»§ç»­',
		'not-started': 'å¼€å§‹',
		locked: 'é”å®š'
	}
	const statusClass = (status : string) => status

	/* äº¤äº’æ–¹æ³• */
	const toggleChapter = (idx : number) => {
		chapters.value[idx].expanded = !chapters.value[idx].expanded
	}
	const openLesson = (lesson : any) => {
		if (lesson.status === 'locked') return
		uni.showToast({ title: `å¼€å§‹å­¦ä¹  ${lesson.title}`, icon: 'none' })
	}
	const goStudy = () => uni.showToast({ title: 'ç»§ç»­å­¦ä¹ å½“å‰è¯¾ç¨‹', icon: 'none' })
	const toggleBookmark = () => {
		bookmarked.value = !bookmarked.value
	}
	const share = () => uni.showToast({ title: 'åˆ†äº«è¯¾ç¨‹ç»™å¥½å‹', icon: 'none' })
	const download = (name : string) => uni.showToast({ title: `ä¸‹è½½ ${name}`, icon: 'none' })
</script>

<style>
	.root {
		flex: 1;
		background: linear-gradient(to bottom right, #f8f9fc, #eef0f8);
	}

	.container {
		padding: 32rpx 32rpx 40rpx;
	}

	/* è¯¾ç¨‹å°é¢ */
	.course-header {
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 40rpx;
		padding: 40rpx;
		margin-bottom: 32rpx;
		border: 2rpx solid #e6e9f0;
	}

	.course-cover {
		width: 100%;
		height: 360rpx;
		border-radius: 24rpx;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		align-items: center;
		justify-content: center;
		margin-bottom: 32rpx;
		overflow: hidden;
		position: relative;
	}

	.mask {
		position: absolute;
		inset: 0;
		background: linear-gradient(to bottom right, rgba(58, 57, 122, .7), rgba(79, 78, 140, .7));
	}

	.course-cover-text {
		position: relative;
		color: #fff;
		font-size: 48rpx;
		z-index: 1;
	}

	.course-title {
		font-size: 48rpx;
		font-weight: 700;
		color: #3a397a;
		margin-bottom: 16rpx;
	}

	.course-instructor {
		font-size: 32rpx;
		color: #6c757d;
		margin-bottom: 16rpx;
	}

	.course-description {
		font-size: 28rpx;
		color: #2c2c2c;
		margin-bottom: 32rpx;
	}

	.course-stats {
		flex-direction: row;
		margin-bottom: 32rpx;
	}

	.stat-tag {
		padding: 12rpx 24rpx;
		background-color: #e6e9ff;
		border-radius: 32rpx;
		font-size: 24rpx;
		color: #3a397a;
		margin-right: 16rpx;
		border: 2rpx solid #d9dcf7;
	}

	.progress-container {
		width: 100%;
		height: 24rpx;
		background-color: #f0f2f7;
		border-radius: 12rpx;
		overflow: hidden;
		margin-bottom: 16rpx;
		border: 2rpx solid #e6e9f0;
	}

	.progress-fill {
		height: 100%;
		background: linear-gradient(to right, #3a397a, #6a69b3);
		border-radius: 12rpx;
	}

	.progress-text {
		font-size: 28rpx;
		color: #6c757d;
		text-align: center;
	}

	/* æ“ä½œæ  */
	.action-bar {
		flex-direction: row;
		margin-bottom: 32rpx;
	}

	.continue-button {
		flex: 1;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		color: #fff;
		border-radius: 24rpx;
		font-size: 32rpx;
		font-weight: bold;
		align-items: center;
		justify-content: center;
		margin-right: 16rpx;
		border: 2rpx solid #2f2e62;
	}

	.action-buttons {
		flex-direction: row;
	}

	.action-button {
		width: 100rpx;
		height: 100rpx;
		border-radius: 24rpx;
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		align-items: center;
		justify-content: center;
		color: #3a397a;
		font-size: 40rpx;
		margin-right: 16rpx;
		border: 2rpx solid #e6e9f0;
	}

	.action-button:last-child {
		margin-right: 0;
	}

	/* è¯¾ç¨‹ç›®å½• */
	.curriculum-section,
	.materials-section,
	.instructor-section {
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 40rpx;
		padding: 40rpx;
		margin-bottom: 32rpx;
		border: 2rpx solid #e6e9f0;
	}

	.section-title {
		font-size: 36rpx;
		font-weight: bold;
		color: #3a397a;
		margin-bottom: 32rpx;
	}

	.chapter-item {
		margin-bottom: 32rpx;
	}

	.chapter-header {
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		padding: 24rpx;
		background-color: #f0f2f7;
		border-radius: 24rpx;
		border: 2rpx solid #e6e9f0;
	}

	.chapter-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #2c2c2c;
	}

	.chapter-progress {
		font-size: 28rpx;
		color: #6c757d;
	}

	.lesson-list {
		max-height: 0;
		overflow: hidden;
		transition: all 0.3s;
	}

	.lesson-list.expanded {
		max-height: 9999rpx;
	}

	.lesson-item {
		flex-direction: row;
		align-items: center;
		padding: 24rpx 0;
		border-bottom: 2rpx solid #e6e9f0;
	}

	.lesson-item:last-child {
		border-bottom: none;
	}

	.lesson-icon {
		width: 60rpx;
		height: 60rpx;
		border-radius: 50%;
		align-items: center;
		justify-content: center;
		margin-right: 24rpx;
		font-size: 28rpx;
	}

	.lesson-icon.completed {
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		color: #fff;
		border: 2rpx solid #2f2e62;
	}

	.lesson-icon.in-progress {
		background-color: #e6e9ff;
		color: #3a397a;
		border: 2rpx solid #d9dcf7;
	}

	.lesson-icon.not-started {
		background-color: #f0f2f7;
		color: #6c757d;
		border: 2rpx solid #e6e9f0;
	}

	.lesson-icon.locked {
		background-color: #f0f2f7;
		color: #ced4da;
		border: 2rpx solid #e6e9f0;
	}

	.lesson-details {
		flex: 1;
	}

	.lesson-title {
		font-size: 28rpx;
		color: #2c2c2c;
		margin-bottom: 8rpx;
	}

	.lesson-meta {
		font-size: 24rpx;
		color: #6c757d;
	}

	.lesson-action {
		padding: 12rpx 24rpx;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		color: #fff;
		border-radius: 16rpx;
		font-size: 24rpx;
		font-weight: 500;
		border: 2rpx solid #2f2e62;
	}

	.lesson-action.locked {
		background-color: #f0f2f7;
		color: #ced4da;
		border: 2rpx solid #e6e9f0;
	}

	/* èµ„æ–™ */
	.material-item {
		flex-direction: row;
		align-items: center;
		padding: 24rpx 0;
		border-bottom: 2rpx solid #e6e9f0;
	}

	.material-item:last-child {
		border-bottom: none;
	}

	.material-icon {
		width: 80rpx;
		height: 80rpx;
		border-radius: 20rpx;
		background-color: #e6e9ff;
		align-items: center;
		justify-content: center;
		color: #3a397a;
		font-size: 36rpx;
		margin-right: 24rpx;
		border: 2rpx solid #d9dcf7;
	}

	.material-details {
		flex: 1;
	}

	.material-title {
		font-size: 28rpx;
		color: #2c2c2c;
		margin-bottom: 8rpx;
	}

	.material-meta {
		font-size: 24rpx;
		color: #6c757d;
	}

	.download-button {
		padding: 12rpx 24rpx;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		color: #fff;
		border-radius: 16rpx;
		font-size: 24rpx;
		font-weight: 500;
		border: 2rpx solid #2f2e62;
	}

	/* è®²å¸ˆ */
	.instructor-header {
		flex-direction: row;
		align-items: center;
		margin-bottom: 32rpx;
	}

	.instructor-avatar {
		width: 120rpx;
		height: 120rpx;
		border-radius: 60rpx;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		align-items: center;
		justify-content: center;
		color: #fff;
		font-size: 48rpx;
		margin-right: 32rpx;
		border: 4rpx solid #fff;
	}

	.instructor-info {
		flex: 1;
	}

	.instructor-name {
		font-size: 36rpx;
		font-weight: bold;
		color: #3a397a;
		margin-bottom: 8rpx;
	}

	.instructor-title {
		font-size: 28rpx;
		color: #6c757d;
	}

	.instructor-description {
		font-size: 28rpx;
		color: #2c2c2c;
		line-height: 1.6;
	}
</style>