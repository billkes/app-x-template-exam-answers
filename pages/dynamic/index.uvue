<template>
	<!-- é¡µé¢çº§æ»šåŠ¨ï¼šæ ¹èŠ‚ç‚¹ scroll-view -->
	<scroll-view class="page-scroll">
		<!-- ä¸ªäººä¿¡æ¯ -->
		<view class="header">
			<text class="user-name">å¼ ä¸‰</text>
		</view>

		<view class="exam-main">
			<!-- æˆ‘çš„è€ƒè¯• -->
			<view class="exam-list">
				<view v-if="filteredExams.length === (0 as number)" class="empty">
					<text>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è€ƒè¯•</text>
				</view>

				<view v-for="item in filteredExams" :key="item.id" class="exam-card">
					<view class="card-header">
						<text class="card-title">{{ item.title }}</text>
						<text :class="['card-status', 'status-' + item.status]">
							{{ statusMap[item.status] }}
						</text>
					</view>

					<view class="card-info">
						<view class="info-item">
							<text class="info-icon">ğŸ“š</text>
							<text>{{ item.subject }} Â· {{ item.type }}</text>
						</view>
						<view class="info-item">
							<text class="info-icon">ğŸ“…</text>
							<text>{{ item.startTime }} - {{ item.endTime }}</text>
						</view>
						<view class="info-item">
							<text class="info-icon">ğŸ“</text>
							<text class="info-text">{{ item.questions }}é¢˜ Â· æ»¡åˆ†{{ item.totalScore }}åˆ†</text>
						</view>
					</view>

					<text class="card-desc">{{ item.description }}</text>

					<view class="card-footer">
						<text class="card-duration">â± {{ item.duration }}</text>
						<button :class="['start-btn', item.status === 'ended' ? 'disabled' : '']"
							:disabled="item.status === 'ended'" @tap="startExam(item.id)">
							{{ item.status === 'ended' ? 'å·²ç»“æŸ' :
		         item.status === 'upcoming' ? 'ç­‰å¾…å¼€å§‹' : 'å¼€å§‹è€ƒè¯•' }}
						</button>
					</view>
				</view>
			</view>

			<!-- éšæœº3æ¡è€ƒè¯• -->
			<view class="exam-list">
				<view v-if="filteredExams.length === (0 as number)" class="empty">
					<text>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è€ƒè¯•</text>
				</view>

				<view v-for="item in filteredExams" :key="item.id" class="exam-card">
					<view class="card-header">
						<text class="card-title">{{ item.title }}</text>
						<text :class="['card-status', 'status-' + item.status]">
							{{ statusMap[item.status] }}
						</text>
					</view>

					<view class="card-info">
						<view class="info-item">
							<text class="info-icon">ğŸ“š</text>
							<text>{{ item.subject }} Â· {{ item.type }}</text>
						</view>
						<view class="info-item">
							<text class="info-icon">ğŸ“…</text>
							<text>{{ item.startTime }} - {{ item.endTime }}</text>
						</view>
						<view class="info-item">
							<text class="info-icon">ğŸ“</text>
							<text class="info-text">{{ item.questions }}é¢˜ Â· æ»¡åˆ†{{ item.totalScore }}åˆ†</text>
						</view>
					</view>

					<text class="card-desc">{{ item.description }}</text>

					<view class="card-footer">
						<text class="card-duration">â± {{ item.duration }}</text>
						<button :class="['start-btn', item.status === 'ended' ? 'disabled' : '']"
							:disabled="item.status === 'ended'" @tap="startExam(item.id)">
							{{ item.status === 'ended' ? 'å·²ç»“æŸ' :
		         item.status === 'upcoming' ? 'ç­‰å¾…å¼€å§‹' : 'å¼€å§‹è€ƒè¯•' }}
						</button>
					</view>
				</view>
			</view>
		</view>
	</scroll-view>
</template>

<script setup lang="uts">
	import { ref, computed } from 'vue'

	type examListType = {
		id : number
		title : string
		type : string
		subject : string
		status : string
		startTime : string
		endTime : string
		duration : string
		description : string
		questions : number
		totalScore : number
	}

	// === æ¨¡æ‹Ÿæ•°æ® ===
	const examList = ref<examListType[]>([
		{
			id: 1,
			title: 'é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•',
			type: 'æœŸä¸­è€ƒè¯•',
			subject: 'æ•°å­¦',
			status: 'active',
			startTime: '2025-08-15 09:00',
			endTime: '2025-08-15 11:00',
			duration: '120åˆ†é’Ÿ',
			description: 'æœ¬è€ƒè¯•æ¶µç›–å¾®ç§¯åˆ†ã€çº¿æ€§ä»£æ•°åŠæ¦‚ç‡è®ºåŸºç¡€çŸ¥è¯†ï¼Œè¯·ç¡®ä¿å……åˆ†å‡†å¤‡ã€‚',
			questions: 50,
			totalScore: 100
		},
		{
			id: 2,
			title: 'å¤§å­¦è‹±è¯­å››çº§æ¨¡æ‹Ÿ',
			type: 'è®¤è¯è€ƒè¯•',
			subject: 'è‹±è¯­',
			status: 'active',
			startTime: '2025-08-15 14:00',
			endTime: '2025-08-15 16:00',
			duration: '120åˆ†é’Ÿ',
			description: 'æ¨¡æ‹Ÿå¤§å­¦è‹±è¯­å››çº§è€ƒè¯•ï¼ŒåŒ…æ‹¬å¬åŠ›ã€é˜…è¯»ã€å†™ä½œå’Œç¿»è¯‘éƒ¨åˆ†ã€‚',
			questions: 65,
			totalScore: 710
		},
		{
			id: 3,
			title: 'ç‰©ç†åŠ›å­¦å•å…ƒæµ‹è¯•',
			type: 'å°æµ‹éªŒ',
			subject: 'ç‰©ç†',
			status: 'upcoming',
			startTime: '2025-08-16 10:00',
			endTime: '2025-08-16 11:30',
			duration: '90åˆ†é’Ÿ',
			description: 'åŠ›å­¦å•å…ƒçŸ¥è¯†æµ‹éªŒï¼ŒåŒ…æ‹¬ç‰›é¡¿å®šå¾‹ã€åŠ¨é‡å®ˆæ’å’Œèƒ½é‡å®ˆæ’ç­‰å†…å®¹ã€‚',
			questions: 30,
			totalScore: 100
		},
		{
			id: 4,
			title: 'æœ‰æœºåŒ–å­¦æœŸæœ«è€ƒè¯•',
			type: 'æœŸæœ«è€ƒè¯•',
			subject: 'åŒ–å­¦',
			status: 'ended',
			startTime: '2025-08-10 09:00',
			endTime: '2025-08-10 11:30',
			duration: '150åˆ†é’Ÿ',
			description: 'æœ‰æœºåŒ–å­¦æœŸæœ«è€ƒè¯•ï¼Œæ¶µç›–æ‰€æœ‰æœ‰æœºåŒ–å­¦ååº”ç±»å‹å’Œæœºç†ã€‚',
			questions: 45,
			totalScore: 100
		}
	])

	// === ç­›é€‰é€»è¾‘ ===
	const typeOptions = ['æœŸä¸­è€ƒè¯•', 'æœŸæœ«è€ƒè¯•', 'å°æµ‹éªŒ', 'è®¤è¯è€ƒè¯•']
	const subjectOptions = ['æ•°å­¦', 'è‹±è¯­', 'ç‰©ç†', 'åŒ–å­¦', 'ç”Ÿç‰©', 'å†å²']
	const statusOptions = ['active', 'upcoming', 'ended']
	const statusMap = { active: 'è¿›è¡Œä¸­', upcoming: 'å³å°†å¼€å§‹', ended: 'å·²ç»“æŸ' }

	const selectedType = ref('')
	const selectedSubject = ref('')
	const selectedStatus = ref('')

	const typeText = computed(() => selectedType.value)
	const subjectText = computed(() => selectedSubject.value)
	const statusText = computed(() => statusMap[selectedStatus.value as 'ended']!)

	const filteredExams = computed(() : Array<examListType> => {
		return examList.value.filter((item : examListType) : boolean => {
			return (selectedType.value === '' || item.type === selectedType.value) &&
				(selectedSubject.value === '' || item.subject === selectedSubject.value) &&
				(selectedStatus.value === '' || item.status === selectedStatus.value)
		})
	})

	function filterExams() {
		// è§¦å‘ computed é‡æ–°è®¡ç®—å³å¯
	}

	// === å¼€å§‹è€ƒè¯• ===
	function startExam(id : number) {
		uni.showToast({ title: `å³å°†è¿›å…¥è€ƒè¯• #${id}`, icon: 'none' })
	}
</script>

<style>
	/* ===== appx å…¼å®¹æ ·å¼ ===== */
	.page-scroll {
		display: flex;
		flex-direction: column;
		background-color: #f9f9ff;
		flex: 1;
	}

	/* === é¡¶éƒ¨ === */
	.header {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		padding-top: 24rpx;
		padding-right: 32rpx;
		padding-bottom: 24rpx;
		padding-left: 32rpx;
		background-color: #3a397a;
	}

	.user-name {
		font-size: 28rpx;
		color: #ffffff;
	}

	/* === ä¸»ä½“ === */
	.main {
		padding-top: 32rpx;
		padding-right: 32rpx;
		padding-bottom: 32rpx;
		padding-left: 32rpx;
	}

	.page-title {
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 32rpx;
		margin-left: 0;
		font-size: 44rpx;
		font-weight: 700;
		color: #3a397a;
	}

	/* === ç­›é€‰æ  === */
	.filters {
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		padding-top: 24rpx;
		padding-right: 24rpx;
		padding-bottom: 24rpx;
		padding-left: 24rpx;
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 32rpx;
		margin-left: 0;
		background-color: #ffffff;
		border-top-left-radius: 16rpx;
		border-top-right-radius: 16rpx;
		border-bottom-right-radius: 16rpx;
		border-bottom-left-radius: 16rpx;
	}

	.filter-item {
		display: flex;
		flex-direction: column;
		min-width: 200rpx;
	}

	.filter-label {
		font-size: 24rpx;
		color: #777777;
	}

	.filter-value {
		font-size: 28rpx;
		color: #333333;
	}

	.search-btn {
		align-self: flex-end;
		padding-top: 16rpx;
		padding-right: 32rpx;
		padding-bottom: 16rpx;
		padding-left: 32rpx;
		background-color: #3a397a;
		color: #ffffff;
		border-top-left-radius: 8rpx;
		border-top-right-radius: 8rpx;
		border-bottom-right-radius: 8rpx;
		border-bottom-left-radius: 8rpx;
		font-size: 28rpx;
	}

	.exam-main {
		padding: 30rpx;
	}

	/* === è€ƒè¯•å¡ç‰‡ === */
	.exam-list {
		display: flex;
		flex-direction: column;
	}

	.exam-card {
		padding-top: 32rpx;
		padding-right: 32rpx;
		padding-bottom: 32rpx;
		padding-left: 32rpx;
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 24rpx;
		margin-left: 0;
		background-color: #ffffff;
		border-left-width: 8rpx;
		border-left-style: solid;
		border-left-color: #3a397a;
		border-top-left-radius: 16rpx;
		border-top-right-radius: 16rpx;
		border-bottom-right-radius: 16rpx;
		border-bottom-left-radius: 16rpx;
	}

	.card-header {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 16rpx;
		margin-left: 0;
	}

	.card-title {
		font-size: 32rpx;
		font-weight: 700;
		color: #3a397a;
	}

	.card-status {
		padding-top: 4rpx;
		padding-right: 12rpx;
		padding-bottom: 4rpx;
		padding-left: 12rpx;
		border-top-left-radius: 20rpx;
		border-top-right-radius: 20rpx;
		border-bottom-right-radius: 20rpx;
		border-bottom-left-radius: 20rpx;
		font-size: 24rpx;
	}

	.status-active {
		background-color: #e6f7e6;
		color: #2e7d32;
	}

	.status-upcoming {
		background-color: #fff8e1;
		color: #ff8f00;
	}

	.status-ended {
		background-color: #fbe9e7;
		color: #d84315;
	}

	.card-info {
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 16rpx;
		margin-left: 0;
	}

	.info-item {
		display: flex;
		flex-direction: row;
		align-items: center;
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 8rpx;
		margin-left: 0;
	}

	.info-text {
		font-size: 28rpx;
		color: #777777;
	}

	.info-icon {
		margin-top: 0;
		margin-right: 8rpx;
		margin-bottom: 0;
		margin-left: 0;
	}

	.card-desc {
		font-size: 28rpx;
		color: #777777;
		margin-top: 0;
		margin-right: 0;
		margin-bottom: 24rpx;
		margin-left: 0;
	}

	.card-footer {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
	}

	.card-duration {
		font-size: 28rpx;
		color: #777777;
	}

	.start-btn {
		padding-top: 16rpx;
		padding-right: 32rpx;
		padding-bottom: 16rpx;
		padding-left: 32rpx;
		background-color: #3a397a;
		color: #ffffff;
		border-top-left-radius: 8rpx;
		border-top-right-radius: 8rpx;
		border-bottom-right-radius: 8rpx;
		border-bottom-left-radius: 8rpx;
		font-size: 28rpx;
	}

	.start-btn.disabled {
		background-color: #cccccc;
	}

	/* === ç©ºåˆ—è¡¨æç¤º === */
	.empty {
		padding-top: 64rpx;
		padding-right: 64rpx;
		padding-bottom: 64rpx;
		padding-left: 64rpx;
		text-align: center;
		color: #777777;
	}

	/* === åˆ†é¡µå ä½ === */
	.pagination {
		margin-top: 32rpx;
		margin-right: 0;
		margin-bottom: 0;
		margin-left: 0;
		text-align: center;
		font-size: 28rpx;
		color: #777777;
	}
</style>