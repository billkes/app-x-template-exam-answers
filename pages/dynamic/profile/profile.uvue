<template>
	<scroll-view class="root">
		<view class="container">

			<!-- 用户信息区域 -->
			<view class="profile-section">
				<view v-if="!isLoggedIn" class="login-section">
					<view class="avatar">
						<text class="icon iconfont icon-user"></text>
					</view>
					<text class="login-text">登录后查看个人信息</text>
					<view class="login-btn" @tap="goToLogin">
						<text class="login-btn-text">立即登录</text>
					</view>
				</view>

				<view v-else>
					<view class="avatar">
						<text class="icon iconfont icon-user"></text>
					</view>

					<view class="user-info" @tap="goEdit">
						<text class="username">李明同学</text>
						<text class="edit-icon iconfont icon-edit"></text>
					</view>

					<text class="user-tagline">“专注备考100天”</text>

					<view class="stats-container">
						<view class="stat-item">
							<text class="stat-value">VIP</text>
							<text class="stat-label">会员</text>
						</view>
						<view class="stat-item">
							<text class="stat-value">8</text>
							<text class="stat-label">勋章</text>
						</view>
						<view class="stat-item stat-item-last">
							<text class="stat-value">100</text>
							<text class="stat-label">学习天数</text>
						</view>
					</view>

					<view class="vip-badge">会员特权</view>
				</view>
			</view>

			<!-- 数据卡片区域 -->
			<view class="data-cards" v-if="isLoggedIn">
				<view class="data-card" @tap="goDetail('时长')">
					<text class="data-value">100h</text>
					<text class="data-label">学习时长</text>
				</view>
				<view class="data-card" @tap="goDetail('正确率')">
					<text class="data-value">85%</text>
					<text class="data-label">正确率</text>
				</view>
				<view class="data-card data-card-last" @tap="goDetail('排名')">
					<text class="data-value">前10%</text>
					<text class="data-label">排名</text>
				</view>
			</view>

			<!-- 功能宫格导航 -->
			<view class="grid-nav" v-if="isLoggedIn">
				<view class="grid-item grid-item-1">
					<view class="grid-item-card" @tap="nav('course')">
						<view class="grid-icon"><text class="iconfont icon-book"></text></view>
						<text class="grid-label">我的课程</text>
					</view>
				</view>
				<view class="grid-item grid-item-2">
					<view class="grid-item-card" @tap="nav('wrong')">
						<view class="grid-icon"><text class="iconfont icon-close"></text></view>
						<text class="grid-label">我的错题</text>
					</view>
				</view>
				<view class="grid-item grid-item-3">
					<view class="grid-item-card" @tap="nav('star')">
						<view class="grid-icon"><text class="iconfont icon-star"></text></view>
						<text class="grid-label">我的收藏</text>
					</view>
				</view>
				<view class="grid-item grid-item-4">
					<view class="grid-item-card" @tap="nav('history')">
						<view class="grid-icon"><text class="iconfont icon-time-circle"></text></view>
						<text class="grid-label">做题历史</text>
					</view>
				</view>
				<view class="grid-item grid-item-5">
					<view class="grid-item-card" @tap="nav('note')">
						<view class="grid-icon"><text class="iconfont icon-edit"></text></view>
						<text class="grid-label">我的笔记</text>
					</view>
				</view>
				<view class="grid-item grid-item-6">
					<view class="grid-item-card" @tap="nav('vip')">
						<view class="grid-icon"><text class="iconfont icon-crown"></text></view>
						<text class="grid-label">会员中心</text>
					</view>
				</view>
			</view>

			<!-- 成就区域 -->
			<view class="achievement-section" v-if="isLoggedIn">
				<view class="section-title">
					<text class="section-title-left">我的成就</text>
					<text class="view-all" @tap="goAchieve">查看全部</text>
				</view>
				<view class="badges-list">
					<view class="badge">
						<view class="card">
							<text class="iconfont icon-trophy"></text>
						</view>
					</view>
					<view class="badge">
						<view class="card">
							<text class="iconfont icon-star"></text>
						</view>
					</view>
				</view>
			</view>

			<!-- 设置区域 -->
			<view class="settings-section">
				<view v-for="(item, idx) in settings.filter(o=>!(o.hide !== null && o.hide === true))" :key="idx"
					class="settings-item" :class="{'settings-item-last': idx === settings.length - 1}"
					@tap="item.action">
					<text class="settings-item-text" :class="item.className">{{ item.text }}</text>
					<text class="arrow">›</text>
				</view>
			</view>

		</view>

		<BottomNav current="mine" />

	</scroll-view>
</template>

<script setup lang="uts">
	import { ref } from 'vue'
	import { SettingsType } from '@/assets/type/profile-page.type.uts'
	import { goToLogin } from '@/untils/navigate.uts'

	const isLoggedIn = ref(false)
	const settings = ref<SettingsType[]>([
		{ text: '设置与隐私', action: () => uni.showToast({ title: '设置页', icon: 'none' }) },
		{ text: '帮助与反馈', action: () => uni.showToast({ title: '帮助页', icon: 'none' }) },
		{ text: '邀请好友得会员', action: () => uni.showToast({ title: '邀请页', icon: 'none' }), hide: true },
		{ text: '关于我们', action: () => uni.showToast({ title: '关于页', icon: 'none' }) },
		{ text: '退出登录', className: 'logout', action: () => confirmLogout(), hide: true }
	])

	const nav = (page : string) => uni.showToast({ title: `跳转到${page}`, icon: 'none' })
	const goEdit = () => uni.showToast({ title: '编辑资料', icon: 'none' })
	const goDetail = (type : string) => uni.showToast({ title: `${type}详情`, icon: 'none' })
	const goAchieve = () => uni.showToast({ title: '全部成就', icon: 'none' })

	const confirmLogout = () => {
		uni.showModal({
			title: '退出登录',
			content: '确定要退出登录吗？',
			success: (res) => {
				if (res.confirm) {
					// 清除用户信息
					try {
						uni.removeStorageSync('userInfo')
						uni.removeStorageSync('token')
						isLoggedIn.value = false
					} catch (e) {
						console.error('清除用户信息失败:', e)
					}

					uni.showToast({
						title: '退出成功',
						icon: 'success'
					})

					// // 跳转到登录页
					// setTimeout(() => {
					// 	uni.redirectTo({
					// 		url: '/pages/dynamic/login-page'
					// 	})
					// }, 1500)
				}
			}
		})
	}
</script>

<style>
	.root {
		flex: 1;
		background: linear-gradient(to bottom right, #f8f9fc, #eef0f8);
	}

	.container {
		padding: 32rpx 32rpx 120rpx;
	}

	/* 用户信息 */
	.profile-section {
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 40rpx;
		padding: 48rpx;
		align-items: center;
		margin-bottom: 32rpx;
		border: 2rpx solid #e6e9f0;
	}

	.avatar {
		width: 160rpx;
		height: 160rpx;
		border-radius: 80rpx;
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		justify-content: center;
		align-items: center;
		margin-bottom: 32rpx;
		border: 6rpx solid #fff;
	}

	.icon {
		font-size: 64rpx;
		color: #fff;
	}

	.user-info {
		flex-direction: row;
		align-items: center;
		margin-bottom: 16rpx;
	}

	.username {
		font-size: 40rpx;
		font-weight: 600;
		color: #2c2c2c;
		margin-right: 16rpx;
	}

	.edit-icon {
		font-size: 32rpx;
		color: #3a397a;
	}

	.user-tagline {
		font-size: 28rpx;
		color: #6c757d;
		margin-bottom: 32rpx;
	}

	.stats-container {
		flex-direction: row;
	}

	.stat-item {
		flex: 1;
		align-items: center;
		padding: 0 32rpx;
		border-right: 2rpx solid #e6e9f0;
	}

	.stat-item-last {
		border-right: none;
	}

	.stat-value {
		font-size: 32rpx;
		font-weight: 600;
		color: #3a397a;
	}

	.stat-label {
		font-size: 24rpx;
		color: #6c757d;
	}

	.vip-badge {
		background: linear-gradient(to bottom right, #ff7e5f, #ff9a8b);
		color: #fff;
		padding: 8rpx 24rpx;
		border-radius: 40rpx;
		font-size: 24rpx;
		font-weight: 500;
		margin-top: 16rpx;
	}

	/* 数据卡片 */
	.data-cards {
		flex-direction: row;
		margin-bottom: 32rpx;
	}

	.data-card {
		flex: 1;
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 24rpx;
		padding: 32rpx;
		align-items: center;
		margin-right: 16rpx;
		border: 2rpx solid #e6e9f0;
	}

	.data-card-last {
		margin-right: 0;
	}

	.data-value {
		font-size: 40rpx;
		font-weight: 600;
		color: #3a397a;
		margin-bottom: 8rpx;
	}

	.data-label {
		font-size: 24rpx;
		color: #6c757d;
	}

	/* 宫格导航 */
	.grid-nav {
		flex-direction: row;
		flex-wrap: wrap;
		margin-bottom: 32rpx;
	}

	.grid-item {
		width: 33%;
	}

	.grid-item-1,
	.grid-item-2,
	.grid-item-3 {
		padding-bottom: 8rpx;
	}

	.grid-item-4,
	.grid-item-5,
	.grid-item-6 {
		padding-top: 8rpx;
	}

	.grid-item-1,
	.grid-item-4 {
		padding-right: 8rpx;
	}

	.grid-item-2,
	.grid-item-5 {
		padding-left: 8rpx;
		padding-right: 8rpx;
	}

	.grid-item-3,
	.grid-item-6 {
		padding-left: 8rpx;
	}

	.grid-item-card {
		align-items: center;
		padding: 32rpx;
		border-radius: 24rpx;
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border: 2rpx solid #e6e9f0;
	}

	.grid-icon {
		width: 80rpx;
		height: 80rpx;
		border-radius: 40rpx;
		background-color: #e6e9ff;
		justify-content: center;
		align-items: center;
		color: #3a397a;
		font-size: 36rpx;
		margin-bottom: 16rpx;
	}

	.grid-label {
		font-size: 24rpx;
		color: #2c2c2c;
	}

	/* 成就区域 */
	.achievement-section {
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 40rpx;
		padding: 40rpx;
		width: 100%;
		margin-bottom: 32rpx;
		border: 2rpx solid #e6e9f0;
	}

	.section-title {
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 32rpx;
	}

	.section-title-left {
		font-size: 36rpx;
		font-weight: 600;
		color: #3a397a;
	}

	.view-all {
		font-size: 24rpx;
		color: #6c757d;
	}

	.badges-list {
		flex-direction: row;
		flex-wrap: wrap;
	}

	.badge {
		width: 25%;
		align-items: center;
		justify-content: center;
	}

	.badge .card {
		width: 100rpx;
		height: 100rpx;
		border-radius: 50rpx;
		justify-content: center;
		align-items: center;
		background: linear-gradient(to bottom, #e6e9ff, #d9dcf7);
		border: 2rpx solid #e6e9f0;
	}

	.badge .iconfont {
		font-size: 48rpx;
	}

	/* 设置列表 */
	.settings-section {
		background: linear-gradient(to bottom, #fff, #f8f9fc);
		border-radius: 40rpx;
		border: 2rpx solid #e6e9f0;
		margin-bottom: 40rpx;
		width: 100%;
	}

	.settings-item {
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		padding: 32rpx 40rpx;
		border-bottom: 2rpx solid #e6e9f0;
	}

	.settings-item-last {
		border-bottom: none;
	}

	.settings-item-text {
		font-size: 32rpx;
		color: #2c2c2c;
	}

	.settings-item-text.logout {
		font-size: 32rpx;
		color: #ff7e5f;
	}

	.arrow {
		font-size: 40rpx;
		color: #6c757d;
	}

	/* 登录区域样式 */
	.login-section {
		align-items: center;
		padding: 48rpx;
	}

	.login-text {
		font-size: 32rpx;
		color: #6c757d;
		margin: 32rpx 0;
		text-align: center;
	}

	.login-btn {
		background: linear-gradient(to bottom right, #3a397a, #4f4e8c);
		border-radius: 40rpx;
		padding: 24rpx 48rpx;
		margin-top: 32rpx;
	}

	.login-btn-text {
		color: #fff;
		font-size: 32rpx;
		font-weight: 500;
	}
</style>